<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I Love You Bro - Support Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #991b1b 0%, #dc2626 50%, #b91c1c 100%);
            min-height: 100vh;
            color: #1f2937;
            line-height: 1.6;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 32px;
            color: white;
        }
        
        .header h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            margin-bottom: 12px;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            letter-spacing: -0.025em;
            cursor: pointer;
        }
        
        .header p {
            font-size: clamp(1rem, 3vw, 1.25rem);
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
            font-weight: 400;
        }
        
        .main-content {
            display: grid;
            gap: 24px;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 32px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1), 0 4px 8px rgba(0,0,0,0.05);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .card h2 {
            color: #dc2626;
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 16px;
            display: block;
        }
        
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .mood-btn {
            aspect-ratio: 1;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }
        
        .mood-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0));
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .mood-btn:hover:before {
            opacity: 1;
        }
        
        .mood-btn.great { 
            background: linear-gradient(135deg, #10b981, #059669); 
            color: white; 
        }
        .mood-btn.good { 
            background: linear-gradient(135deg, #84cc16, #65a30d); 
            color: white; 
        }
        .mood-btn.okay { 
            background: linear-gradient(135deg, #f59e0b, #d97706); 
            color: white; 
        }
        .mood-btn.tough { 
            background: linear-gradient(135deg, #f97316, #ea580c); 
            color: white; 
        }
        .mood-btn.struggling { 
            background: linear-gradient(135deg, #ef4444, #dc2626); 
            color: white; 
        }
        
        .mood-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
        }
        
        .mood-btn.selected {
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.8), 0 8px 20px rgba(0,0,0,0.15);
            border: 3px solid #fff;
        }
        
        .issues-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .issue-btn {
            padding: 20px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 16px;
            background: white;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            text-align: center;
            min-height: 100px;
        }
        
        .issue-btn:hover {
            border-color: #dc2626;
            background: #fef2f2;
            transform: translateY(-1px);
        }
        
        .issue-btn.selected {
            border-color: #dc2626;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.3), 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .issue-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }
        
        .input-group {
            margin-bottom: 24px;
        }
        
        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 1rem;
        }
        
        .input-group textarea,
        .input-group select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.2s ease;
            font-family: inherit;
            resize: vertical;
        }
        
        .input-group textarea:focus,
        .input-group select:focus {
            outline: none;
            border-color: #dc2626;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1);
        }
        
        .submit-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .submit-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2), rgba(255,255,255,0));
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .submit-btn:hover:before {
            opacity: 1;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(220, 38, 38, 0.3);
        }
        
        .submit-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }
        
        .resources-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 16px;
        }
        
        .resource-card {
            background: linear-gradient(135deg, #f8faff, #f1f5f9);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            padding: 24px;
            transition: all 0.2s ease;
            cursor: pointer;
            text-align: center;
        }
        
        .resource-card:hover {
            border-color: #dc2626;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .resource-card h3 {
            color: #dc2626;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 1rem;
            font-weight: 600;
        }
        
        .resource-card p {
            color: #64748b;
            font-size: 0.875rem;
            line-height: 1.5;
        }
        
        .success-message {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 24px;
            text-align: center;
            font-weight: 600;
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.3);
        }
        
        .admin-panel {
            background: white;
            border-radius: 20px;
            padding: 32px;
            margin-top: 24px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 24px;
            border-radius: 16px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .chart-container {
            height: 240px;
            background: linear-gradient(135deg, #f8faff, #f1f5f9);
            border: 2px solid #e2e8f0;
            border-radius: 16px;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #64748b;
            font-weight: 500;
        }
        
        .hidden {
            display: none;
        }
        
        .error-message {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            padding: 16px;
            border-radius: 12px;
            margin-bottom: 24px;
            text-align: center;
            font-weight: 500;
        }
        
        @media (max-width: 640px) {
            .container {
                padding: 16px;
            }
            
            .card {
                padding: 24px;
            }
            
            .mood-grid {
                gap: 8px;
            }
            
            .mood-btn {
                font-size: 0.75rem;
                gap: 4px;
            }
            
            .issues-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 8px;
            }
            
            .issue-btn {
                padding: 16px 12px;
                font-size: 0.8rem;
                min-height: 80px;
            }
            
            .resources-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>I Love You Bro</h1>
            <p>Your voice matters. You are not alone. There is strength in speaking up.</p>
        </div>
        
        <div class="main-content">
            <!-- Daily Check-in Card -->
            <div class="card">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="8 14s1.5 2 4 2 4-2 4-2"/>
                        <line x1="9" y1="9" x2="9.01" y2="9"/>
                        <line x1="15" y1="9" x2="15.01" y2="9"/>
                    </svg>
                    Daily Check-in
                </h2>
                
                <label class="section-title">How are you feeling today?</label>
                <div class="mood-grid">
                    <button class="mood-btn great" data-mood="great">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="8 14s1.5 2 4 2 4-2 4-2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        Great
                    </button>
                    <button class="mood-btn good" data-mood="good">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="8 14s1.5 2 4 2 4-2 4-2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        Good
                    </button>
                    <button class="mood-btn okay" data-mood="okay">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <line x1="8" y1="15" x2="16" y2="15"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        Okay
                    </button>
                    <button class="mood-btn tough" data-mood="tough">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="16 16s-1.5-2-4-2-4 2-4 2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        Tough
                    </button>
                    <button class="mood-btn struggling" data-mood="struggling">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="16 16s-1.5-2-4-2-4 2-4 2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        Struggling
                    </button>
                </div>
                
                <label class="section-title">What's on your mind? (Select all that apply)</label>
                <div class="issues-grid">
                    <button class="issue-btn" data-issue="work-stress">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
                            <line x1="8" y1="21" x2="16" y2="21"/>
                            <line x1="12" y1="17" x2="12" y2="21"/>
                        </svg>
                        Work Stress
                    </button>
                    <button class="issue-btn" data-issue="relationships">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                        Relationships
                    </button>
                    <button class="issue-btn" data-issue="anxiety">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
                        </svg>
                        Anxiety
                    </button>
                    <button class="issue-btn" data-issue="depression">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="16 16s-1.5-2-4-2-4 2-4 2"/>
                            <line x1="9" y1="9" x2="9.01" y2="9"/>
                            <line x1="15" y1="9" x2="15.01" y2="9"/>
                        </svg>
                        Depression
                    </button>
                    <button class="issue-btn" data-issue="finances">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="1" x2="12" y2="23"/>
                            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                        </svg>
                        Money Issues
                    </button>
                    <button class="issue-btn" data-issue="family">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                            <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                        </svg>
                        Family
                    </button>
                    <button class="issue-btn" data-issue="addiction">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M12 1v6m0 6v6m11-7h-6m-6 0H1m15.5-6.5l-4.24 4.24m-6.06 0L2.5 6.5m12.73 12.73l-4.24-4.24m-6.06 0L2.5 17.5"/>
                        </svg>
                        Addiction
                    </button>
                    <button class="issue-btn" data-issue="isolation">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                            <circle cx="12" cy="7" r="4"/>
                        </svg>
                        Loneliness
                    </button>
                    <button class="issue-btn" data-issue="health">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                        </svg>
                        Health
                    </button>
                    <button class="issue-btn" data-issue="other">
                        <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="1"/>
                            <circle cx="19" cy="12" r="1"/>
                            <circle cx="5" cy="12" r="1"/>
                        </svg>
                        Other
                    </button>
                </div>
                
                <div class="input-group">
                    <label>Want to share more? (Optional)</label>
                    <textarea placeholder="What's been on your mind? How can the group support you?" rows="3"></textarea>
                </div>
                
                <div class="input-group">
                    <label>Which group do you attend?</label>
                    <select id="groupLocation">
                        <option value="">Select your group</option>
                        <option value="downtown-monday">Downtown - Monday 7PM</option>
                        <option value="north-side-wednesday">North Side - Wednesday 6:30PM</option>
                        <option value="west-end-friday">West End - Friday 7PM</option>
                        <option value="south-bay-saturday">South Bay - Saturday 10AM</option>
                        <option value="online-thursday">Online - Thursday 8PM</option>
                    </select>
                </div>
                
                <button class="submit-btn" onclick="submitCheckIn()">Submit Check-in</button>
            </div>
            
            <!-- Resources Card -->
            <div class="card">
                <h2>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                    Resources & Support
                </h2>
                
                <div class="resources-grid">
                    <div class="resource-card" onclick="openResource('crisis')">
                        <h3>
                            <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
                            </svg>
                            Crisis Support
                        </h3>
                        <p>24/7 helplines and immediate support</p>
                    </div>
                    
                    <div class="resource-card" onclick="openResource('professional')">
                        <h3>
                            <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            Find a Therapist
                        </h3>
                        <p>Professional mental health resources</p>
                    </div>
                    
                    <div class="resource-card" onclick="openResource('wellness')">
                        <h3>
                            <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                            </svg>
                            Wellness Tools
                        </h3>
                        <p>Meditation, exercise, and self-care</p>
                    </div>
                    
                    <div class="resource-card" onclick="openResource('meetings')">
                        <h3>
                            <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            Meeting Schedule
                        </h3>
                        <p>All group locations and times</p>
                    </div>
                    
                    <div class="resource-card" onclick="openResource('stories')">
                        <h3>
                            <svg class="issue-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                <polyline points="14,2 14,8 20,8"/>
                            </svg>
                            Success Stories
                        </h3>
                        <p>Hope and inspiration from fellow Bros</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Admin Panel (Hidden by default) -->
        <div id="adminPanel" class="admin-panel hidden">
            <h2>
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                </svg>
                Admin Dashboard
            </h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalCheckins">--</div>
                    <div>Total Check-ins This Week</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgMood">--</div>
                    <div>Average Mood Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="topIssue">--</div>
                    <div>Most Common Issue</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeGroups">--</div>
                    <div>Active Groups</div>
                </div>
            </div>
            
            <div class="chart-container">
                <p>Real-time Mood Trends - Data updates automatically</p>
            </div>
            
            <div class="input-group">
                <label>Export Data for Fundraising</label>
                <button class="submit-btn" onclick="exportData()">Generate Fundraising Report</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration using Environment Variables
        const SUPABASE_URL = process.env.NEXT_PUBLIC_SUPABASE_URL
        const SUPABASE_ANON_KEY = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
        
        // Check if environment variables are loaded
        if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
            console.error('Missing Supabase environment variables. Please check your .env.local file or Vercel environment variables.');
            // Show error message to user
            const errorMsg = document.createElement('div');
            errorMsg.className = 'error-message';
            errorMsg.textContent = 'Configuration error. Please contact support if this issue persists.';
            document.querySelector('.main-content').insertBefore(errorMsg, document.querySelector('.main-content').firstChild);
        }
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
        
        // Store current form data
        let userData = {
            mood: null,
            issues: [],
            notes: '',
            group: '',
            timestamp: null
        };
        
        // Initialize event listeners when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            initializeEventListeners();
            setupRealtimeUpdates();
        });
        
        function initializeEventListeners() {
            // Mood selection
            document.querySelectorAll('.mood-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
                    btn.classList.add('selected');
                    userData.mood = btn.dataset.mood;
                });
            });
            
            // Issue selection
            document.querySelectorAll('.issue-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    btn.classList.toggle('selected');
                    const issue = btn.dataset.issue;
                    if (userData.issues.includes(issue)) {
                        userData.issues = userData.issues.filter(i => i !== issue);
                    } else {
                        userData.issues.push(issue);
                    }
                });
            });
            
            // Admin panel toggle
            let adminClicks = 0;
            document.querySelector('.header h1').addEventListener('click', () => {
                adminClicks++;
                if (adminClicks >= 5) {
                    const password = prompt('Enter admin password:');
                    if (password === 'iloveyoubro2024') {
                        document.getElementById('adminPanel').classList.remove('hidden');
                        updateAdminStats();
                    }
                    adminClicks = 0;
                }
            });
        }
        
        async function submitCheckIn() {
            const notes = document.querySelector('textarea').value;
            const group = document.getElementById('groupLocation').value;
            
            if (!userData.mood) {
                alert('Please select how you\'re feeling today');
                return;
            }
            
            if (!group) {
                alert('Please select which group you attend');
                return;
            }
            
            // Show loading state
            const submitBtn = document.querySelector('.submit-btn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Submitting...';
            submitBtn.disabled = true;
            
            try {
                // Submit to Supabase
                const { data, error } = await supabase
                    .from('checkins')
                    .insert([
                        {
                            mood: userData.mood,
                            issues: userData.issues,
                            notes: notes,
                            group_name: group
                        }
                    ]);
                
                if (error) {
                    throw error;
                }
                
                // Show success message
                const successMsg = document.createElement('div');
                successMsg.className = 'success-message';
                successMsg.textContent = 'Thank you for checking in! Your voice matters and helps our community grow stronger.';
                document.querySelector('.card').insertBefore(successMsg, document.querySelector('.card').firstChild);
                
                // Reset form
                document.querySelectorAll('.mood-btn, .issue-btn').forEach(btn => btn.classList.remove('selected'));
                document.querySelector('textarea').value = '';
                document.getElementById('groupLocation').value = '';
                userData = { mood: null, issues: [], notes: '', group: '', timestamp: null };
                
                // Hide success message after 5 seconds
                setTimeout(() => {
                    if (successMsg.parentNode) {
                        successMsg.remove();
                    }
                }, 5000);
                
            } catch (error) {
                console.error('Error submitting check-in:', error);
                alert('There was an error submitting your check-in. Please try again.');
            } finally {
                // Reset button state
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }
        
        function openResource(type) {
            const resources = {
                crisis: 'National Suicide Prevention Lifeline: 988\nCrisis Text Line: Text HOME to 741741\n\nFor immediate help, please call 911.',
                professional: 'Psychology Today: psychologytoday.com\nBetterHelp: betterhelp.com\nLocal mental health services directory\n\nFind qualified therapists in your area.',
                wellness: 'Headspace meditation app\nCalm app\nLocal gym partnerships\nYoga with Adriene (YouTube)\n\nTake care of your mental and physical health.',
                meetings: 'Current Meeting Schedule:\n\nDowntown - Monday 7PM\nNorth Side - Wednesday 6:30PM\nWest End - Friday 7PM\nSouth Bay - Saturday 10AM\nOnline - Thursday 8PM\n\nAll meetings are free and confidential.',
                stories: 'Read inspiring stories from fellow Bros who have overcome challenges and found hope through our community support groups.'
            };
            
            alert(resources[type] || 'Resource information coming soon!');
        }
        
        async function exportData() {
            try {
                const { data, error } = await supabase
                    .from('checkins')
                    .select('*')
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                const report = generateFundraisingReport(data);
                
                const blob = new Blob([report], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `iloveyoubro-impact-report-${new Date().toISOString().split('T')[0]}.txt`;
                a.click();
                URL.revokeObjectURL(url);
                
            } catch (error) {
                console.error('Error exporting data:', error);
                alert('Error exporting data. Please try again.');
            }
        }
        
        function generateFundraisingReport(data) {
            const totalEntries = data.length;
            if (totalEntries === 0) {
                return 'No data available for report generation.';
            }
            
            const moodCounts = {};
            const issueCounts = {};
            const groupCounts = {};
            const last30Days = new Date();
            last30Days.setDate(last30Days.getDate() - 30);
            
            const recent30DaysData = data.filter(entry => 
                new Date(entry.created_at) > last30Days
            );
            
            data.forEach(entry => {
                // Count moods
                moodCounts[entry.mood] = (moodCounts[entry.mood] || 0) + 1;
                
                // Count issues
                if (entry.issues && Array.isArray(entry.issues)) {
                    entry.issues.forEach(issue => {
                        issueCounts[issue] = (issueCounts[issue] || 0) + 1;
                    });
                }
                
                // Count groups
                groupCounts[entry.group_name] = (groupCounts[entry.group_name] || 0) + 1;
            });
            
            const strugglingPercentage = ((moodCounts['struggling'] || 0) + (moodCounts['tough'] || 0)) / totalEntries * 100;
            const topIssues = Object.entries(issueCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([issue, count]) => `${issue.replace('-', ' ')}: ${count} people (${(count/totalEntries*100).toFixed(1)}%)`);
            
            return `I LOVE YOU BRO - IMPACT REPORT
Generated: ${new Date().toLocaleDateString()}
Report Period: All Time (Last 30 days: ${recent30DaysData.length} check-ins)

COMMUNITY ENGAGEMENT:
- Total check-ins all time: ${totalEntries}
- Check-ins last 30 days: ${recent30DaysData.length}
- Active support groups: ${Object.keys(groupCounts).length}
- Average monthly engagement: ${(totalEntries / Math.max(1, Math.ceil((Date.now() - new Date(data[data.length-1]?.created_at || Date.now()).getTime()) / (1000 * 60 * 60 * 24 * 30)))).toFixed(1)} check-ins

MENTAL HEALTH INSIGHTS:
- Bros seeking support: ${strugglingPercentage.toFixed(1)}% reporting tough days or struggling
- Most common challenges:
${topIssues.length > 0 ? topIssues.map(issue => `  • ${issue}`).join('\n') : '  • No data available'}

GROUP PARTICIPATION:
${Object.entries(groupCounts).length > 0 ? 
    Object.entries(groupCounts).map(([group, count]) => 
        `- ${group.replace('-', ' ')}: ${count} check-ins (${(count/totalEntries*100).toFixed(1)}%)`
    ).join('\n') : 
    '- No group data available'
}

MOOD DISTRIBUTION:
- Great: ${moodCounts['great'] || 0} (${((moodCounts['great'] || 0)/totalEntries*100).toFixed(1)}%)
- Good: ${moodCounts['good'] || 0} (${((moodCounts['good'] || 0)/totalEntries*100).toFixed(1)}%)
- Okay: ${moodCounts['okay'] || 0} (${((moodCounts['okay'] || 0)/totalEntries*100).toFixed(1)}%)
- Tough: ${moodCounts['tough'] || 0} (${((moodCounts['tough'] || 0)/totalEntries*100).toFixed(1)}%)
- Struggling: ${moodCounts['struggling'] || 0} (${((moodCounts['struggling'] || 0)/totalEntries*100).toFixed(1)}%)

IMPACT STATEMENT:
This data represents real people in our community reaching out for support. Each check-in is a moment where someone chose connection over isolation. Your donation helps us:

• Provide safe spaces for vulnerable men to share their struggles
• Track community mental health trends to respond to emerging needs
• Offer targeted resources based on real data about what Bros are facing
• Expand our reach to serve more communities across different locations
• Maintain 24/7 crisis support resources for those in immediate need

Every dollar invested creates measurable impact in men's mental health. The data shows that ${strugglingPercentage.toFixed(1)}% of our community members are actively seeking help during difficult times - demonstrating the critical need for continued support.

CONTACT: For more information about this data or our programs, please contact the I Love You Bro support team.

---
Generated automatically from secure, anonymized check-in data.
All personal information remains confidential and protected.`;
        }
        
        async function updateAdminStats() {
            try {
                // Get data from last 7 days
                const weekAgo = new Date();
                weekAgo.setDate(weekAgo.getDate() - 7);
                
                const { data: recentData, error } = await supabase
                    .from('checkins')
                    .select('*')
                    .gte('created_at', weekAgo.toISOString());
                
                if (error) throw error;
                
                document.getElementById('totalCheckins').textContent = recentData.length;
                
                if (recentData.length > 0) {
                    const moodValues = { 'great': 5, 'good': 4, 'okay': 3, 'tough': 2, 'struggling': 1 };
                    const avgMood = recentData.reduce((sum, entry) => sum + moodValues[entry.mood], 0) / recentData.length;
                    document.getElementById('avgMood').textContent = avgMood.toFixed(1);
                    
                    const issueCounts = {};
                    recentData.forEach(entry => {
                        if (entry.issues && Array.isArray(entry.issues)) {
                            entry.issues.forEach(issue => {
                                issueCounts[issue] = (issueCounts[issue] || 0) + 1;
                            });
                        }
                    });
                    
                    const topIssue = Object.entries(issueCounts)
                        .sort(([,a], [,b]) => b - a)[0];
                    document.getElementById('topIssue').textContent = topIssue ? 
                        topIssue[0].replace('-', ' ') : 'No issues reported';
                    
                    const uniqueGroups = new Set(recentData.map(entry => entry.group_name));
                    document.getElementById('activeGroups').textContent = uniqueGroups.size;
                } else {
                    document.getElementById('avgMood').textContent = 'No data';
                    document.getElementById('topIssue').textContent = 'No data';
                    document.getElementById('activeGroups').textContent = '0';
                }
                
            } catch (error) {
                console.error('Error updating admin stats:', error);
                document.getElementById('totalCheckins').textContent = 'Error';
                document.getElementById('avgMood').textContent = 'Error';
                document.getElementById('topIssue').textContent = 'Error';
                document.getElementById('activeGroups').textContent = 'Error';
            }
        }
        
        // Real-time updates for admin dashboard
        function setupRealtimeUpdates() {
            if (!SUPABASE_URL || !SUPABASE_ANON_KEY) {
                console.warn('Skipping real-time setup due to missing environment variables');
                return;
            }
            
            supabase
                .channel('checkins-channel')
                .on('postgres_changes', 
                    { event: 'INSERT', schema: 'public', table: 'checkins' }, 
                    (payload) => {
                        console.log('New check-in received:', payload.new);
                        // Update admin dashboard if it's visible
                        if (!document.getElementById('adminPanel').classList.contains('hidden')) {
                            updateAdminStats();
                        }
                    }
                )
                .subscribe();
        }
    </script>
</body>
</html>
